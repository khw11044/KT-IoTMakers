# KT-IoTMakers
River Flood Notification Service Using KT Platform - IoTMakers - with arduino mkr wifi 1010


https://blog.naver.com/khw11044

먼저 아두이노 MKR wifi 1010을 준비합니다. (아두이노가 와이파이 칩을 통해 무선랜에 접속할 수 있기떄문)
Arduino IDE의 [스케치]-[라이브러리 포함하기]-[라이브러리 관리]
라이브러리 매니저 검색창에 WIFININA를 입력하여 검색된 WIFININA라이브러리를 설치합니다.

KT 사물인터넷 플랫폼
http://iotmakers.kt.com/openp/index.html#/auth/login

회원 가입
로그인 --> [IoT개발] --> [나의 디바이스] -->"디바이스 등록" --> 디바이스 명 지어줍니다.(저의 경우 MiddleProject라고 했습니다.)
<사진1>

1. 수위측정노드 만들기

만들고 나면 만든 디바이스 목록이 나옵니다. 클릭하고 들어가면

디바이스 상세 정보를 볼수 있습니다.

<사진2>

그중에 3개의 카테고리가 있습니다. Tag Stream, SDK, Event

<사진3>

이중에 Tag Stream을 클릭하고 Tag Stream ID에 WaterLevel, Tag Stream Type은 수집, Value Type은 숫자형식으로 해줍니다.

다시  Tag Stream ID에 LEDRed, Tag Stream Type은 제어, Value Type은 문자형식으로 해줍니다.

마찬가지로 ID를 LEDYellow, LEDGreen을 만들어줍니다

<사진4>


다음으로 IoTMakers에서 [IoT개발]-[이벤트관리]를 클릭합니다.

"이벤트 등록"바를 클릭합니다.

1.[디바이스데이터]바를 모눈종이위로 드래그앤드롭합니다. '수정'을 누르고 디바이스를 골라줍니다.

2.[이벤트 정의]바를 마찬가지로 [디바이스데이터]바 옆으로 드래그앤드롭합니다. '수정'을 누르고

이벤트 구분 -> 주의, 이벤트명 :수위안전 이라고 하고 저장을 누릅니다.

[디바이스데이터]와 [이벤트 정의]칸을 화살표선으로 이어줍니다.

3.[이벤트발생조건]바를 [이벤트 정의]칸 안에 넣습니다. '수정'을 클릭후 [논리식 입력기]카테고리의 '디바이스데이터'를

선택 첫빈칸 WaterLevel 두번째 빈칸 < 세번째 빈칸 100을 넣고 '추가하기'버튼을 누른후 저장합니다.

4.[제어]바를 [이벤트데이터]바 옆에 드래그앤드롭하고 둘을 연결합니다. '수정'을 누르면

디바이스목록은 있는 디바이스모델명과 디바이스명을 써주시고 제어 태그스트림에서 태그스트림명은 LEDGreen, 타입은 문자열, 제어 값은 ON을 

해주고 추가 버튼을 누릅니다.

한번더 그대로 선택하고 제어값만 OFF를 해주고 추가하기 저장을 누릅니다. 전체 저장을 누르면 [IoT개발]-[이벤트 관리]에 수위안전 이벤트가

생성된것을 알수 있습니다.

<사진>

위와 같은 방법으로 수위안전, 수위경고, 수위위험, 수위대피 이벤트를 만들어 봅니다. 

<사진>

수위대피의 경우 [SMS]바도 드래그앤드롭하여 [이벤트데이터]바와 연결합니다. 대비이벤트 발생시 문자알림을 받을 수 있습니다,

<사진>

 

다음으로 SDK카테고리를 클릭합니다. 그러면 Arduino에 SDK를 다운받습니다. 압축을 풀면 SDK_Arduino_2.0.1파일이 있습니다.

그폴더 안에 IoTMakers파일만 복사하여 문서\Arduino\libraries 에 옮깁니다.

https://kwanulee.github.io/IoTPlatform/release/IoTMakersDemoMKR1010.zip

를 다운로드하여 Arduino IDE에서 실행해봅니다.


소스코드에서 다음을 찾아 사용 환경에 맞도록 수정후, 빌드/업로드 합니다.


WIFI_SSID = 무선랜아이디

WIFI_PASS = 무선랜패스워드

deviceID = 디바이스아이디

authnRqtNo = 디바이스패스워드

extrSysID = gateway 연결ID


성공적으로 되었다면 KT플랫폼에 디바이스목록에 연결상태가 ON이 되는것을 확인해볼수있습니다.

'WaterLevel파일'을 다운받고 수위를 측정하는 아두이노에 컴파일-업로드해주세요


수위에 따라 초록,노랑,빨강 LED에 불이 들어오는것이 보일겁니다. 또 그 값을 IoTMakers플랫폼을 통해 

확인해볼수 있습니다.

<사진5>


대피이벤트발생 수준의 수위일때 LEDRed가 깜빡거리고 부저가 울릴니다.


===============================================================


2. 수문제어노드 만들기

[IoT개발] --> [나의 디바이스] -->"디바이스 등록" --> 디바이스 명 지어줍니다.(저의 경우 MiddleProject2라고 했습니다)

Tag Stream을 클릭하고 Tag Stream ID에 Servo, Tag Stream Type은 제어, Value Type은 문자형식으로 해줍니다.


다음으로 다시 [IoT개발] --> [이벤트 관리]에 '안전'이벤트는 아래 사진과 같이 제어를 수정해줍니다.

<사진>

'수위경고'도 아래 사진과 같이 제어 수정

<사진>

'수위위험'도 아래 사진과 같이 제어 수정

<사진>

'수위대피'도 아래 사진과 같이 제어 수정

<사진>

'WaterDoor파일'을 다운받고 수문 아두이노mkr1010에 컴파일-업로드합니다.


최종적으로 아래 영상과 같은 변화를 볼수 있습니다.


이러한 데이터들의 변화를 쉽게 비주얼적으로 보기위해 웹대시보드를 만들어 모니터링 합니다.

'monitoring파일'을 다운받습니다. 아래 사진과 같은 그래프와 표를 확인할 수 있을 겁니다.




